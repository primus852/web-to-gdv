$(function(){}),$(document).on("change",".inputFile",function(e){e.preventDefault();var t=$(this).attr("data-job"),n=$(this).attr("data-form"),a=$("#inv"+n+"Form_"+t)[0],r=$("#rep"+n+"Type_"+t);console.log(n);var o=$("#dropA_"+t),s=$("#dropI_"+t),i=$("#dropZ_"+t),l=o.html(),u=s.html(),c=i.html();o.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> Lade...'),s.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> Lade...'),i.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> Lade...');var d=$("#ajax-route-upload-file").val();$.ajax({url:d,data:new FormData(a),type:"post",contentType:!1,processData:!1,cache:!1,dataType:"json",error:function(e){openNoty(e.result,e.message),o.removeClass("disabled").html(l),s.removeClass("disabled").html(u),i.removeClass("disabled").html(c),r.val("")},success:function(e){if(o.removeClass("disabled").html(l),s.removeClass("disabled").html(u),i.removeClass("disabled").html(c),r.val(""),"success"===e.result){if("pdfinvoice"===e.extra.type&&(openNoty(e.result,e.message),"success"===e.result&&location.reload()),"invoice"===e.extra.type&&("success"===e.result?(openNoty(e.result,"Rechnung an 3C übermittelt, Auftrag abgeschlossen."),$("#row_"+t).remove()):openNoty(e.result,e.message)),"attachment"===e.extra.type&&openNoty(e.result,e.message),"report"===e.extra.type){var n=$("#label_"+t);openNoty(e.result,e.message);var a=parseInt(n.html());a+=1,n.html(a)}}else openNoty(e.result,e.message)},complete:function(){console.log("Request finished.")}})}),$(document).on("click",".js-save-manual",function(e){e.preventDefault();var t=$(this),n=t.html(),a=t.attr("data-url"),r=$("#referenceNo").val(),o=$("#insuranceContractNo").val(),s=$("#insuranceDamageNo").val(),i=$("#insuranceVuNo").val(),l=$("#insuranceName").val();return r.length&&o.length&&s.length&&i.length?"NONE"===l?(openNoty("error","Bitte eine Versicherung wählen."),!1):!t.hasClass("disabled")&&(t.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> Speichere...'),void $.get(a,{referenceNo:r,insuranceContractNo:o,insuranceDamageNo:s,insuranceVuNo:i,insuranceId:l}).done(function(e){openNoty(e.result,e.message),"success"===e.result&&$('input[type="text"]').val(""),t.removeClass("disabled").html(n)}).error(function(){openNoty(data.result,data.message),t.removeClass("disabled").html(n)})):(openNoty("error","Bitte alle Felder ausfüllen."),!1)}),$(document).on("click",".js-select-file",function(e){e.preventDefault();var t=$(this),n=t.attr("data-type"),a=t.attr("data-form"),r=t.html(),o=t.attr("data-job"),s=$("#rep"+a+"Type_"+o),i=t.attr("data-desc");s.val(n),x0p({title:"Bericht versenden?",text:"Möchten Sie <strong>"+i+"</strong> vom Typ '<strong>"+r+"</strong>' versenden?",html:!0,maxHeight:"200px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"error",text:"Abbrechen",showLoading:!1},{type:"ok",text:"Datei wählen",showLoading:!1}]}).then(function(e){"ok"===e.button?$("#inpt"+a+"_"+o).trigger("click"):s.val("")})}),$(document).on("click",".js-receipt-job",function(e){e.preventDefault();var t=$(this),n=t.attr("data-id"),a=t.attr("data-job");x0p({title:"Auftrag annehmen?",text:"Wollen Sie den Auftrag "+a+" quittieren?",html:!0,maxHeight:"200px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"error",text:"Abbrechen",showLoading:!1},{type:"warning",text:"Auftrag ablehnen",showLoading:!1},{type:"ok",text:"Auftrag annehmen",showLoading:!0}]}).then(function(e){"ok"===e.button&&$.post(t.attr("data-url"),{id:n,status:"accept",reason:"OK"}).done(function(e){"success"===e.result?x0p("Erfolg","Auftrag angenommen, Quittung übermittelt","ok",!1).then(function(e){t.remove(),$("#jobRow_"+n).remove()}):x0p("Fehler",e.message,"error",!1)}).fail(function(){x0p("Fehler","Fehler bei der Quttierung, bitte versuchen Sie es erneut","error",!1)}),"warning"===e.button&&x0p({title:"Begründung",text:'Bitte wählen Sie einen Grund<br /><select id="selectReason" data-id="'+n+'"><option value="NONE" >-- Bitte wählen --</option><option value="01: Kunde möchte gar keinen Sanierer" >01: Kunde möchte gar keinen Sanierer</option><option value="02: Kunde möchte diesen Sanierer nicht">02: Kunde möchte diesen Sanierer nicht</option><option value="03: Kunde nicht erreichbar">03: Kunde nicht erreichbar</option><option value="04: Sanierer hat keine Kapazität">04: Sanierer hat keine Kapazität</option></select>',html:!0,maxHeight:"200px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"error",text:"Abbrechen",showLoading:!1},{type:"warning",text:"Auftrag ablehnen",showLoading:!0}]}).then(function(e){if("warning"===e.button){var a=$("#reason_"+n);$.post(t.attr("data-url"),{id:n,status:"decline",reason:a.val()}).done(function(e){"success"===e.result?x0p("Erfolg","Auftrag abgelehnt, Quittung übermittelt","ok",!1).then(function(e){t.remove(),$("#jobRow_"+n).remove()}):x0p("Fehler",e.message,"error",!1)}).fail(function(){x0p("Fehler","Fehler bei der Quttierung, bitte versuchen Sie es erneut","error",!1)})}})})}),$(document).on("change","#selectReason",function(e){e.preventDefault();var t=$(this).attr("data-id");$("#reason_"+t).val($("#selectReason option:selected").text())});
