$(function(){});$(document).on("change",".inputFile",function(h){h.preventDefault();var j=$(this).attr("data-job");var c=$(this).attr("data-form");var b=$("#inv"+c+"Form_"+j)[0];var l=$("#rep"+c+"Type_"+j);console.log(c);var f=$("#dropA_"+j);var a=$("#dropI_"+j);var d=$("#dropZ_"+j);var m=f.html();var g=a.html();var k=d.html();f.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> Lade...');a.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> Lade...');d.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> Lade...');var i=$("#ajax-route-upload-file").val();$.ajax({url:i,data:new FormData(b),type:"post",contentType:false,processData:false,cache:false,dataType:"json",error:function(e){openNoty(e.result,e.message);f.removeClass("disabled").html(m);a.removeClass("disabled").html(g);d.removeClass("disabled").html(k);l.val("")},success:function(o){f.removeClass("disabled").html(m);a.removeClass("disabled").html(g);d.removeClass("disabled").html(k);l.val("");if(o.result==="success"){if(o.extra.type==="pdfinvoice"){openNoty(o.result,o.message);if(o.result==="success"){location.reload()}}if(o.extra.type==="invoice"){if(o.result==="success"){openNoty(o.result,"Rechnung an 3C übermittelt, Auftrag abgeschlossen.");$("#row_"+j).remove()}else{openNoty(o.result,o.message)}}if(o.extra.type==="attachment"){openNoty(o.result,o.message)}if(o.extra.type==="report"){var n=$("#label_"+j);openNoty(o.result,o.message);var e=parseInt(n.html());e=e+1;n.html(e)}}else{openNoty(o.result,o.message)}},complete:function(){console.log("Request finished.")}})});$(document).on("click",".js-save-manual",function(c){c.preventDefault();var f=$(this);var b=f.html();var d=f.attr("data-url");var j=$("#referenceNo").val();var g=$("#insuranceContractNo").val();var a=$("#insuranceDamageNo").val();var i=$("#insuranceVuNo").val();var h=$("#insuranceName").val();if(!j.length||!g.length||!a.length||!i.length){openNoty("error","Bitte alle Felder ausfüllen.");return false}if(h==="NONE"){openNoty("error","Bitte eine Versicherung wählen.");return false}if(f.hasClass("disabled")){return false}f.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i> Speichere...');$.get(d,{referenceNo:j,insuranceContractNo:g,insuranceDamageNo:a,insuranceVuNo:i,insuranceId:h}).done(function(e){openNoty(e.result,e.message);if(e.result==="success"){$('input[type="text"]').val("")}f.removeClass("disabled").html(b)}).error(function(){openNoty(data.result,data.message);f.removeClass("disabled").html(b)})});$(document).on("click",".js-select-file",function(g){g.preventDefault();var d=$(this);var a=d.attr("data-type");var i=d.attr("data-form");var c=d.html();var h=d.attr("data-job");var f=$("#rep"+i+"Type_"+h);var b=d.attr("data-desc");f.val(a);x0p({title:"Bericht versenden?",text:"Möchten Sie <strong>"+b+"</strong> vom Typ '<strong>"+c+"</strong>' versenden?",html:true,maxHeight:"200px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"error",text:"Abbrechen",showLoading:false},{type:"ok",text:"Datei wählen",showLoading:false}]}).then(function(e){if(e.button==="ok"){$("#inpt"+i+"_"+h).trigger("click")}else{f.val("")}})});$(document).on("click",".js-receipt-job",function(b){b.preventDefault();var a=$(this);var d=a.attr("data-id");var c=a.attr("data-job");x0p({title:"Auftrag annehmen?",text:"Wollen Sie den Auftrag "+c+" quittieren?",html:true,maxHeight:"200px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"error",text:"Abbrechen",showLoading:false},{type:"warning",text:"Auftrag ablehnen",showLoading:false},{type:"ok",text:"Auftrag annehmen",showLoading:true}]}).then(function(e){if(e.button==="ok"){$.post(a.attr("data-url"),{id:d,status:"accept",reason:"OK"}).done(function(f){if(f.result==="success"){x0p("Erfolg","Auftrag angenommen, Quittung übermittelt","ok",false).then(function(g){a.remove();$("#jobRow_"+d).remove()})}else{x0p("Fehler",f.message,"error",false)}}).fail(function(){x0p("Fehler","Fehler bei der Quttierung, bitte versuchen Sie es erneut","error",false)})}if(e.button==="warning"){x0p({title:"Begründung",text:'Bitte wählen Sie einen Grund<br /><select id="selectReason" data-id="'+d+'"><option value="NONE" >-- Bitte wählen --</option><option value="01: Kunde möchte gar keinen Sanierer" >01: Kunde möchte gar keinen Sanierer</option><option value="02: Kunde möchte diesen Sanierer nicht">02: Kunde möchte diesen Sanierer nicht</option></select>',html:true,maxHeight:"200px",maxWidth:"500px",animationType:"fadeIn",buttons:[{type:"error",text:"Abbrechen",showLoading:false},{type:"warning",text:"Auftrag ablehnen",showLoading:true}]}).then(function(g){if(g.button==="warning"){var f=$("#reason_"+d);$.post(a.attr("data-url"),{id:d,status:"decline",reason:f.val()}).done(function(h){if(h.result==="success"){x0p("Erfolg","Auftrag abgelehnt, Quittung übermittelt","ok",false).then(function(i){a.remove();$("#jobRow_"+d).remove()})}else{x0p("Fehler",h.message,"error",false)}}).fail(function(){x0p("Fehler","Fehler bei der Quttierung, bitte versuchen Sie es erneut","error",false)})}})}})});$(document).on("change","#selectReason",function(b){b.preventDefault();var a=$(this);var c=a.attr("data-id");$("#reason_"+c).val($("#selectReason option:selected").text())});